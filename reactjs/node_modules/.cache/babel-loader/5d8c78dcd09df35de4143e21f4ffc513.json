{"ast":null,"code":"import _regeneratorRuntime from \"C:\\\\Users\\\\Valentin\\\\new_js\\\\spring-boot-security-postgresql-master\\\\src\\\\main\\\\webapp\\\\reactjs\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\nimport _slicedToArray from \"C:\\\\Users\\\\Valentin\\\\new_js\\\\spring-boot-security-postgresql-master\\\\src\\\\main\\\\webapp\\\\reactjs\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";\nimport _asyncToGenerator from \"C:\\\\Users\\\\Valentin\\\\new_js\\\\spring-boot-security-postgresql-master\\\\src\\\\main\\\\webapp\\\\reactjs\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";\nvar _jsxFileName = \"C:\\\\Users\\\\Valentin\\\\new_js\\\\spring-boot-security-postgresql-master\\\\src\\\\main\\\\webapp\\\\reactjs\\\\src\\\\components\\\\login1.js\";\nimport React, { useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { useNavigate } from \"react-router-dom\";\n\nfunction loginUser(_x) {\n  return _loginUser.apply(this, arguments);\n}\n\nfunction _loginUser() {\n  _loginUser = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(credentials) {\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            return _context3.abrupt(\"return\", fetch('http://localhost:8083/api/auth/signin', {\n              method: 'POST',\n              headers: {\n                'Content-Type': 'application/json'\n              },\n              body: JSON.stringify(credentials)\n            }).then(function (data) {\n              return data;\n            }));\n\n          case 1:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3);\n  }));\n  return _loginUser.apply(this, arguments);\n}\n\nfunction checkUser(_x2) {\n  return _checkUser.apply(this, arguments);\n}\n\nfunction _checkUser() {\n  _checkUser = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(token) {\n    return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            return _context4.abrupt(\"return\", fetch('http://localhost:8083/api/test/user', {\n              method: 'GET',\n              headers: {\n                'x-access-token': token\n              }\n            }).then(function (data) {\n              return data;\n            }));\n\n          case 1:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, _callee4);\n  }));\n  return _checkUser.apply(this, arguments);\n}\n\nexport default function Login(_ref) {\n  var setToken = _ref.setToken;\n  var navigate = useNavigate();\n\n  var _useState = useState(),\n      _useState2 = _slicedToArray(_useState, 2),\n      username = _useState2[0],\n      setUserName = _useState2[1];\n\n  var _useState3 = useState(),\n      _useState4 = _slicedToArray(_useState3, 2),\n      password = _useState4[0],\n      setPassword = _useState4[1];\n\n  var checkToken = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var token, data, json_data;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              token = localStorage.getItem('x-auth-token');\n\n              if (!(token !== null)) {\n                _context.next = 13;\n                break;\n              }\n\n              _context.next = 4;\n              return checkUser(token);\n\n            case 4:\n              data = _context.sent;\n              _context.next = 7;\n              return data.json();\n\n            case 7:\n              json_data = _context.sent;\n\n              if (!(json_data.message === \"Access granted\")) {\n                _context.next = 13;\n                break;\n              }\n\n              setToken(token);\n              navigate(\"/\");\n              console.log(\"Access granted\");\n              return _context.abrupt(\"return\", token);\n\n            case 13:\n              return _context.abrupt(\"return\", null);\n\n            case 14:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function checkToken() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  document.addEventListener(\"DOMContentLoaded\", checkToken);\n\n  var handleSubmit = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e) {\n      var answer, json_answer, div, tag, text, _tag, _text;\n\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              e.preventDefault();\n              _context2.next = 3;\n              return loginUser({\n                username: username,\n                password: password\n              });\n\n            case 3:\n              answer = _context2.sent;\n              console.log(answer);\n              _context2.next = 7;\n              return answer.json();\n\n            case 7:\n              json_answer = _context2.sent;\n              console.log(json_answer);\n\n              if (!(answer.status === 200)) {\n                _context2.next = 15;\n                break;\n              }\n\n              localStorage.setItem('x-auth-token', json_answer.accessToken);\n              _context2.next = 13;\n              return checkToken();\n\n            case 13:\n              _context2.next = 16;\n              break;\n\n            case 15:\n              if (document.querySelector(\"#warning\") === null) {\n                div = document.querySelector(\"#main\");\n                tag = document.createElement(\"p\");\n                tag.id = \"warning\";\n                tag.style.color = \"red\";\n                text = document.createTextNode(json_answer.message);\n                tag.appendChild(text);\n                div.appendChild(tag);\n              } else if (document.querySelector(\"#warning\") !== null) {\n                _tag = document.querySelector(\"#warning\");\n\n                _tag.removeChild(_tag.firstChild);\n\n                _text = document.createTextNode(json_answer.message);\n\n                _tag.appendChild(_text);\n              }\n\n            case 16:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function handleSubmit(_x3) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    id: \"main\",\n    className: \"login-wrapper\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 77,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"h1\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 13\n    }\n  }, \"Please Log In\"), /*#__PURE__*/React.createElement(\"form\", {\n    onSubmit: handleSubmit,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"label\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 21\n    }\n  }, \"Username\"), /*#__PURE__*/React.createElement(\"input\", {\n    type: \"text\",\n    onChange: function onChange(e) {\n      return setUserName(e.target.value);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 21\n    }\n  })), /*#__PURE__*/React.createElement(\"label\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 21\n    }\n  }, \"Password\"), /*#__PURE__*/React.createElement(\"input\", {\n    type: \"password\",\n    onChange: function onChange(e) {\n      return setPassword(e.target.value);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 86,\n      columnNumber: 21\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    type: \"submit\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 21\n    }\n  }, \"Submit\"))));\n}\nLogin.propTypes = {\n  setToken: PropTypes.func.isRequired\n};","map":{"version":3,"sources":["C:/Users/Valentin/new_js/spring-boot-security-postgresql-master/src/main/webapp/reactjs/src/components/login1.js"],"names":["React","useState","PropTypes","useNavigate","loginUser","credentials","fetch","method","headers","body","JSON","stringify","then","data","checkUser","token","Login","setToken","navigate","username","setUserName","password","setPassword","checkToken","localStorage","getItem","json","json_data","message","console","log","document","addEventListener","handleSubmit","e","preventDefault","answer","json_answer","status","setItem","accessToken","querySelector","div","tag","createElement","id","style","color","text","createTextNode","appendChild","removeChild","firstChild","target","value","propTypes","func","isRequired"],"mappings":"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","sourcesContent":["import React, {useState} from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { useNavigate } from \"react-router-dom\";\r\n\r\nasync function loginUser(credentials) {\r\n    return fetch('http://localhost:8083/api/auth/signin', {\r\n        method: 'POST',\r\n        headers: {\r\n            'Content-Type': 'application/json'\r\n        },\r\n        body: JSON.stringify(credentials)\r\n    })\r\n        .then(data => data)\r\n}\r\n\r\nasync function checkUser(token) {\r\n    return fetch('http://localhost:8083/api/test/user', {\r\n        method: 'GET',\r\n        headers: {\r\n            'x-access-token': token\r\n        }\r\n    })\r\n        .then(data => data)\r\n}\r\n\r\nexport default function Login({setToken}) {\r\n    let navigate = useNavigate();\r\n    const [username, setUserName] = useState();\r\n    const [password, setPassword] = useState();\r\n\r\n    const checkToken = async () => {\r\n        let token = localStorage.getItem('x-auth-token');\r\n        if (token !== null) {\r\n            let data = await checkUser(token);\r\n            let json_data = await data.json();\r\n            if (json_data.message === \"Access granted\") {\r\n                setToken(token);\r\n                navigate(\"/\");\r\n                console.log(\"Access granted\")\r\n                return token;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n    document.addEventListener(\"DOMContentLoaded\", checkToken);\r\n\r\n    const handleSubmit = async e => {\r\n        e.preventDefault();\r\n        const answer = await loginUser({\r\n            username: username,\r\n            password: password\r\n        });\r\n        console.log(answer);\r\n        const json_answer = await answer.json();\r\n        console.log(json_answer);\r\n        if (answer.status === 200) {\r\n            localStorage.setItem('x-auth-token', json_answer.accessToken);\r\n            await checkToken();\r\n        }\r\n        else if (document.querySelector(\"#warning\") === null) {\r\n            let div = document.querySelector(\"#main\")\r\n            let tag = document.createElement(\"p\");\r\n            tag.id = \"warning\";\r\n            tag.style.color = \"red\";\r\n            let text = document.createTextNode(json_answer.message);\r\n            tag.appendChild(text);\r\n            div.appendChild(tag);\r\n        } else if (document.querySelector(\"#warning\") !== null) {\r\n            let tag = document.querySelector(\"#warning\");\r\n            tag.removeChild(tag.firstChild);\r\n            let text = document.createTextNode(json_answer.message);\r\n            tag.appendChild(text);\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div id={\"main\"} className=\"login-wrapper\">\r\n            <h1>Please Log In</h1>\r\n            <form onSubmit={handleSubmit}>\r\n                <label>\r\n                    <p>Username</p>\r\n                    <input type=\"text\" onChange={e => setUserName(e.target.value)}/>\r\n                </label>\r\n                <label>\r\n                    <p>Password</p>\r\n                    <input type=\"password\" onChange={e => setPassword(e.target.value)}/>\r\n                </label>\r\n                <div>\r\n                    <button type=\"submit\">Submit</button>\r\n                </div>\r\n            </form>\r\n        </div>\r\n    )\r\n}\r\n\r\nLogin.propTypes = {\r\n    setToken: PropTypes.func.isRequired\r\n};"]},"metadata":{},"sourceType":"module"}